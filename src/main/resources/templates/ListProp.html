<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Lista de Propietarios</title>
    <meta charset="UTF-8">

    <link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap.css}">
    <link rel="stylesheet" th:href="@{/boxicons/css/boxicons.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/tables.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* Tus estilos existentes */
        .table-container {
            margin-top: 60px;
            margin-right: auto;
            margin-left: auto;
            padding: 20px;
            width: 80%;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .table {
            width: 100%;
            max-width: 600px;
        }

        .table thead {
            background-color: #007bff;
            color: white;
        }

        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .table tbody tr:hover {
            background-color: #f1f1f1;
        }

        .btn {
            margin: 5px;
        }

        /* Estilos adicionales para el modal */
        .modal-dialog {
            max-width: 500px;
        }

        .modal-title {
            font-weight: bold;
        }
        .modal-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
}

.modal-title {
    font-size: 1.5rem;
    font-weight: bold;
}

.form-control {
    border-radius: 4px;
    margin-bottom: 10px;
}

.modal-footer .btn-primary {
    background-color: #007bff;
    border-color: #007bff;
    box-shadow: none;
}

.modal-footer .btn-secondary {
    background-color: #6c757d;
    border-color: #6c757d;
}

label {
    font-weight: bold;
    color: #495057;
}

select.form-select,
input.form-control {
    background-color: #f8f9fa;
    border: 1px solid #ced4da;
}

button.btn {
    width: 100%;
    font-weight: bold;
}

.modal-footer button.btn-primary:hover {
    background-color: #0056b3;
}

.modal-footer button.btn-secondary:hover {
    background-color: #5a6268;

    .modal-custom-width {
    max-width: 100%; /* O un ancho específico como 900px */
    width: 100px; /* O el tamaño que prefieras */
}
}

    </style>
</head>
<body>
<nav th:replace="~{/layout/navbar :: navbar}"></nav>
<nav th:replace="~{/layout/sidebar :: sidebar}"></nav>

<div class="container">
    <h1>Lista de Propietarios</h1>

    <div class="table-container">
        <table class="table">
            <thead>
            <tr>
                <th>Documento</th>
                <th>Tipo</th>
                <th>Nombre</th>
                <th>Fecha Inicio</th>
                <th>Acciones</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="prop : ${propietarios}">
                <td th:text="${prop.nrodid}"></td>
                <td th:text="${prop.tdipro}"></td>
                <td th:text="${prop.nompro + ' ' + prop.apppro + ' ' + prop.apmpro}"></td>
                <td th:text="${prop.fchcre}"></td>
                <td>


                    <form th:action="@{/propietarios/delete/{id}(id=${prop.idPro})}" method="post" style="display:inline;">
                        <button type="submit" class="btn btn-danger btn-sm"
                                onclick="return confirm('¿Estás seguro de eliminar este propietario?');">
                            Eliminar
                        </button>
                    </form>
                    <button class="btn btn-warning"
                            th:data-id="${prop.idPro}"
                            th:data-tipo="${prop.tdipro}"
                            th:data-documento="${prop.nrodid}"
                            th:data-apepaterno="${prop.apppro}"
                            th:data-apematerno="${prop.apmpro}"
                            th:data-nombres="${prop.nompro}"
                            th:data-ubigeo="${prop.codubg}"
                            th:data-direccion="${prop.dirpro}"
                            th:data-telefono="${prop.telpro}"
                            th:data-celular="${prop.celpro}"
                            th:data-email="${prop.emPro}"
                            onclick="editarPropietario(this)">
                        Editar
                    </button>
                </td>
            </tr>
            </tbody>
        </table>

        <div>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPropModal">
                Agregar Propietario
            </button>
        </div>
    </div>
</div>

<!-- Modal para Nuevo Propietario -->

<div class="modal fade" id="addPropModal" tabindex="-1" aria-labelledby="addPropModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-custom-width">

        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addPropModalLabel">NUEVO PROPIETARIO</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Formulario dentro del modal -->
                <form id="propietarioForm" th:action="@{/propietarios/save}" method="post">
                    <input type="hidden" id="idPro" name="idPro">

                    <div class="mb-3 row">
                        <label for="tipo" class="col-sm-3 col-form-label">Tipo:</label>
                        <div class="col-sm-3">
                            <select class="form-select" id="tipo" name="tdipro" onchange="setTipoPropietario()">
                                <option value="Dni">Dni</option>
                                <option value="Ruc">Ruc</option>
                                <option value="Carnet de Extranjeria">Carnet de Extranjeria</option>
                            </select>
                        </div>

                        <label for="documento" class="col-sm-3 col-form-label">N° Documento:</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id="documento" name="nrodid" placeholder="N° de Documento">
                        </div>
                    </div>
                    <input type="hidden" id="tpepro" name="tpepro" value="">

                    <div class="mb-3 row">
                        <label for="apePaterno" class="col-sm-3 col-form-label">Ape. Paterno:</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="apePaterno" name="apppro" placeholder="Apellido Paterno">
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="apeMaterno" class="col-sm-3 col-form-label">Ape. Materno:</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="apeMaterno" name="apmpro" placeholder="Apellido Materno">
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="nombres" class="col-sm-3 col-form-label">Nombres:</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="nombres" name="nompro" placeholder="Nombres">
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="ubigeo" class="col-sm-3 col-form-label">Ubigeo:</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" id="ubigeo" name="codubg" placeholder="071104">
                        </div>
                        <div class="col-sm-3">
                            <button class="btn btn-light"><i class="fa fa-search"></i></button>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="direccion" class="col-sm-3 col-form-label">Dirección:</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="direccion" name="dirpro" placeholder="Dirección">
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="telefono" class="col-sm-3 col-form-label">N° Teléfono:</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="telefono" name="telpro" placeholder="084 121 200">
                        </div>
                        <label for="celular" class="col-sm-2 col-form-label">N° Celular:</label>
                        <div class="col-sm-3">
                            <input type="text" class="form-control" id="celular" name="celpro" placeholder="987654321">
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="email" class="col-sm-3 col-form-label">Email:</label>
                        <div class="col-sm-9">
                            <input type="email" class="form-control" id="email" name="emPro" placeholder="Email">
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>

    </div>
</div>


<!-- Scripts -->
<script th:src="@{/js/script.js}" type="application/javascript"></script>
<script th:src="@{/js/bootstrap.bundle.js}" type="application/javascript"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
    // Listener para el botón "Nuevo Propietario"
    document.querySelector('[data-bs-target="#addPropModal"]').addEventListener('click', function() {
        // Cambiar el título del modal
        document.getElementById('addPropModalLabel').textContent = 'NUEVO PROPIETARIO';

        // Limpiar el formulario
        document.getElementById('propietarioForm').reset();

        // Asegurarse de que el ID esté vacío
        document.getElementById('idPro').value = '';

        // Opcionalmente, establecer valores por defecto si es necesario
        document.getElementById('tipo').value = 'Dni'; // O el valor por defecto que prefieras

        // Si tienes otros campos que necesiten valores por defecto, agrégalos aquí
    });
});

    function editarPropietario(button) {
     // Establecer el título del modal
     document.getElementById('addPropModalLabel').textContent = 'EDITAR PROPIETARIO';

     // Llenar el formulario con los datos del propietario
     document.getElementById('idPro').value = button.dataset.id;
     document.getElementById('tipo').value = button.dataset.tipo;
     document.getElementById('documento').value = button.dataset.documento;
     document.getElementById('apePaterno').value = button.dataset.apepaterno;
     document.getElementById('apeMaterno').value = button.dataset.apematerno;
     document.getElementById('nombres').value = button.dataset.nombres;
     document.getElementById('ubigeo').value = button.dataset.ubigeo;
     document.getElementById('direccion').value = button.dataset.direccion;
     document.getElementById('telefono').value = button.dataset.telefono;
     document.getElementById('celular').value = button.dataset.celular;
     document.getElementById('email').value = button.dataset.email;

     // Abrir el modal
     var modal = new bootstrap.Modal(document.getElementById('addPropModal'));
     modal.show();
 }

    document.getElementById('addPropModal').addEventListener('hidden.bs.modal', function () {
    // Esto se ejecutará cada vez que el modal se cierre
    document.getElementById('propietarioForm').reset();
    document.getElementById('idPro').value = '';
});
</script>
</body>
</html>